import pytest

from cveminer.models import CommitClassifier
from cveminer.models import GitExtractor

class TestCommitClassifier(object):
    
    @pytest.fixture
    def gitExtractor(self):
        gitExtractor = GitExtractor()
        return gitExtractor

    @pytest.fixture
    def commitClassifier(self):
        commitClassifier = CommitClassifier()
        return commitClassifier

    @pytest.fixture
    def url(self):
        return 'https://github.com/MBalazs8796/testing'

    def test_get_cve_commits(self, gitExtractor, commitClassifier, url):
        result = commitClassifier.get_cve_commits(gitExtractor.get_online_logs(url))
        assert len(result) == 2
        for r in result:
            assert 'CVE' in r
            if r == 'CVE-2000-0012':
                assert result[r].foundCommit['message'] == 'cve-2000-0012 has been found'
                assert result[r].fixCommit['message'] == 'cve-2000-0012 has been fixed'
                assert result[r].between == 1
                assert len(result[r].contributors) == 1
                assert result[r].severity == 'HIGH'
                assert result[r].base_score == 10.0
            elif r == 'CVE-2000-0001':
                assert result[r].foundCommit == result[r].fixCommit
                assert result[r].between == 0