import argparse
from . import miner


def main():
    arg_parser = argparse.ArgumentParser(description='Mine a repository for CVEs and create a report based on the findings')
    group = arg_parser.add_mutually_exclusive_group(required=True)
    group.add_argument('-o', '--online', metavar='', help='Download and mine a repository from an online git repo')
    group.add_argument('-l', '--local', metavar='', help='Mine a local git repo')
    group.add_argument('-d', '--download', action='store_true', help='Download CVEs and insert them into csv files')
    group.add_argument('-db', '--database', action='store_true', help='Create database and store CVEs')
    group.add_argument('-j', '--json', metavar='', help='Mine every repo from a GHtorrent json data dump')
    arg_parser.add_argument('-p', '--password', action='store', dest='password', default=None, help='The password for the Postgres database')
    arg_parser.add_argument('-ak', '--apikey', action='store', dest='apikey', default=None, help='The api key for Airtable')
    args = arg_parser.parse_args()
    if args.download or args.database:
        miner.manage_cves(args)
    elif args.online or args.local:
        miner.get_stats(args, insert_db=True)
    else:
        miner.parse_ghtorrent_json(args)


if __name__ == '__main__':
    main()
