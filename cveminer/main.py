import argparse
from . import miner
from . import manager

def main():
    arg_parser = argparse.ArgumentParser(description='Mine a repository for CVEs and create a report based on the findings')
    group = arg_parser.add_mutually_exclusive_group(required=True)
    group.add_argument('-o', '--online', metavar='', help='Download and mine a repository from an online git repo')
    group.add_argument('-l', '--local', metavar='', help='Mine a local git repo')
    arg_parser.add_argument('-s', '--setup', action='store_true', dest='setup', default=False, help='Set up the CVEs and csv files')
    arg_parser.add_argument('-i', '--input', action='store', dest='input', default=None, help='The directory where NVD json files will been downloaded, and the one from where they will be parsed')
    arg_parser.add_argument('-r', '--result', action='store', dest='results', default=None, help='The directory where the csv files will be stored')
    arg_parser.add_argument('-u', '--user', action="store", dest="user", default="postgres", help="The user to connect to the database.")
    arg_parser.add_argument('-ow', '--owner', action="store", dest="owner", default=None, help="The owner of the database (if different from the connected user).")
    arg_parser.add_argument('-ps', '--password', action="store", dest="password", default="", help="The password to connect to the database.")
    arg_parser.add_argument('-host', '--host', action="store", dest="host", default="localhost", help="The host or IP of the database server.")
    arg_parser.add_argument('-db', '--database', action="store", dest="database", default=None, help="The name of the database.")
    args = arg_parser.parse_args()
    # this is just a placeholder so I can see that the arguments work
    print(miner.mine_repo(args))
    manager.manage_cves(args)

if __name__=='__main__':
    main()